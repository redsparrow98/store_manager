{% extends "base.html" %}
{% block title %}Inventory{% endblock %}
{% block content %}


<div class="inventory-header">
  <h1 class="title">All Products</h1>

    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
      {% for category, message in messages %}
      {{ message }}
      {% endfor %}
    {% endif %} {% endwith %}

  <div class="inventory-actions">
    <form class="search-button-form btn btn--search" action="{{ url_for('display_inventory') }}" method="get" role="search" aria-label="Search products">
      <span class="search-icon" aria-hidden="true">
        <img src="{{ url_for('static', filename='images/search.svg') }}" alt="">
        <!-- Christmas search icon -->
        <span class="nav-icon christmas-search-icon" aria-hidden="true"></span>
      </span>
      <input
        type="search"
        name="search_term"
        class="search-input-in-btn"
        placeholder="Search by product ID or brand"
        value="{{ request.args.get('search_term','') }}"
      />
    </form>

    <!-- Filter by category -->

    <a
      id="filterToggle" class="btn btn-discount"
    >
      <img
        src="{{ url_for('static', filename='images/filter.svg') }}"
        alt="filter"
        class="btn-icon"
      />
      <span class="nav-icon christmas-filter-icon" aria-hidden="true"></span>
      <span class="btn-label">Filter</span>
    </a>

    <!-- Add discount -->
    <a
      class="btn btn-discount"
      href="{{ url_for('apply_discount_page') }}"
    >
      <img
        src="{{ url_for('static', filename='images/discount.svg') }}"
        alt="discount"
        class="btn-icon"
      />
      <span class="nav-icon christmas-discount-icon" aria-hidden="true"></span>
      <span class="btn-label">Add discount</span>
    </a>

    <!-- Add product -->
    {% if access_level in ["Manager"] %}
    <a
      class="btn btn-discount"
      href="{{ url_for('add_product_page') }}"
    >
      <img
        src="{{ url_for('static', filename='images/plus.svg') }}"
        alt="add"
        class="btn-icon"
      />
      <!-- Christmas plus icon -->
      <span class="btn-icon christmas-plus-icon" aria-hidden="true"></span>
      <span class="btn-label">Add product</span>
    </a>
    {% endif %}
  </div>
</div>

<div id="filterPanel" hidden>
  <div class="table-wrap filter-row">
    <div class="filter-column" id="categoryFiltersWrapper">
      <h4>Category</h4>
      <div id="categoryFilters"></div>
    </div>
    <div class="filter-column" id="priceFiltersWrapper">
      <h4>Price</h4>
      <div id="priceFilters"></div>
    </div>
    <div class="filter-column" id="stockFiltersWrapper">
      <h4>Stock</h4>
      <div id="stockFilters"></div>
    </div>
    <div class="filter.column" id="discountFiltersWrapper">
      <h4>Discount</h4>
      <div id="discountFilters"></div>
    </div>
  </div>
</div>

<div class="table-wrap">
  <table class="products-table">
    <thead>
      <tr>
        <th class="col-name">Item name</th>
        <th class="col-id">Product ID</th>
        <th class="col-cat">Category</th>
        <th class="col-price">Price</th>
        <th class="col-discount">Discount</th>
        <th class="col-amount">Amount</th>
        <th class="col-actions">Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be populated by JS -->
    </tbody>
  </table>
</div>

<!-- Flask data -->
<script>
  window.PRODUCTS_DATA = {{ products | tojson}};
</script>

<!-- Inventory display -->
 <script>
  // Pass url for action buttons
const BASE_URLS = {
  view: "{{ url_for('access_product') }}",
  edit: "{{ url_for('update_product_page')}}",
  delete: "{{ url_for('delete_product_page')}}"
}

// Pass products data to JS
const PRODUCTS = Object.entries({{ products | tojson }}).map(
    ([id, item]) => ({
    id: id,
    name: item.article_name,
    category: item.category,
    price: item.price_SEK ?? item.price,
    amount: item.stock_amount ?? item.stock,
    discount: item.discount_percentage || 0
})
);

// Pass access level to JS
const accessLevel = "{{ access_level }}";
 </script>

<!-- Inventory display with filters -->
<script src="{{ url_for('static', filename='JavaScript/filter.js') }}"></script>

{% endblock %}