{% extends "base.html" %}
{% block title %}Inventory{% endblock %}
{% block content %}

<div class="inventory-header">
  <h1 class="title">All Products</h1>

    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
      {% for category, message in messages %}
      {{ message }}
      {% endfor %}
    {% endif %} {% endwith %}

  <div class="inventory-actions">
    <form class="search-button-form btn btn--search" action="{{ url_for('display_inventory') }}" method="get" role="search" aria-label="Search products">
      <span class="search-icon" aria-hidden="true">
        <img src="{{ url_for('static', filename='images/search.svg') }}" alt="">
      </span>
      <input
        type="search"
        name="search_term"
        class="search-input-in-btn"
        placeholder="Search by product ID or brand"
        value="{{ request.args.get('search_term','') }}"
      />
    </form>

    <!-- Add discount -->
    <a class="btn btn-discount" href="{{ url_for('apply_discount_page') }}">
      Apply discount
    </a>

    <!-- Add product -->
    <a
      class="plus-btn"
      href="{{ url_for('add_product_page') }}"
      title="Add product"
    >
      <img
        src="{{ url_for('static', filename='images/plus.svg') }}"
        alt="add"
      />
    </a>
  </div>
</div>

<div class="table-wrap">
  <table class="products-table">
    <thead>
      <tr>
        <th class="col-name">Item name</th>
        <th class="col-id">Product ID</th>
        <th class="col-cat">Category</th>
        <th class="col-price">Price</th>
        <th class="col-discount">Discount percentage</th>
        <th class="col-amount">Amount</th>
        <th class="col-actions">Action</th>
      </tr>
    </thead>
    <tbody>
      {% if products %}
        {% for article_id, item in products.items() %}
          <tr>
            <td class="col-name">{{ item.get('article_name','') }}</td>
            <td class="col-id">{{ article_id }}</td>
            <td class="col-cat">{{ item.get('category','') }}</td>
            <td class="col-price">{{ item.get('price_SEK', item.get('price','')) }} kr</td>
            <td class="col-discount">{{ item.get('discount_percentage','0') }}%</td>
            <td class="col-amount">{{ item.get('stock_amount', item.get('stock','')) }} pcs</td>
            <td class="col-actions">
              <div class="col-actions">
                <a class="icon-btn" href="{{ url_for('access_product') }}?search_term={{ article_id }}" title="View">
                  <img src="{{ url_for('static', filename='images/eye.svg') }}" alt="View">
                </a>
                <a class="icon-btn" href="{{ url_for('update_product_page') }}?article_id={{ article_id }}" title="Edit">
                  <img src="{{ url_for('static', filename='images/edit.svg') }}" alt="Edit">
                </a>
                <a class="icon-btn" href="{{ url_for('delete_product_page') }}?article_id={{ article_id }}" title="Delete">
                  <img src="{{ url_for('static', filename='images/delete.svg') }}" alt="Delete">
                </a>
              </div>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="7">No products found for "{{ search_term }}".</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% endblock %}
